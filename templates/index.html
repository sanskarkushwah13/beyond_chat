<!DOCTYPE html>
<html>
<head>
    <title>Citations</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        table { width: 100%; border-collapse: collapse; }
        table, th, td { border: 1px solid black; }
        th, td { padding: 15px; text-align: left; }
        th { background-color: #f2f2f2; }
        #refresh { margin-bottom: 20px; padding: 10px; cursor: pointer; }
        #save { margin-bottom: 20px; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Citations</h1>
    <button id="refresh">Refresh</button>
    <button id="save">Save</button>
    <table id="citationsTable">
        <thead>
            <tr>
                <th>Source ID</th>
                <th>Link</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        function fetchCitations() {
            fetch('/citations')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#citationsTable tbody');
                    tableBody.innerHTML = '';  // Clear existing content
                    data.forEach(citation => {
                        citation.citations.forEach(source => {
                            const row = document.createElement('tr');

                            const idCell = document.createElement('td');
                            idCell.textContent = source.id;
                            row.appendChild(idCell);

                            const linkCell = document.createElement('td');
                            const link = source.link || 'No link';
                            linkCell.innerHTML = `<a href="${link !== 'No link' ? link : '#'}">${link}</a>`;
                            row.appendChild(linkCell);

                            tableBody.appendChild(row);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error fetching citations:', error);
                });
        }

        function saveCitations() {
            fetch('/save', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Data saved successfully!');
                } else {
                    alert('Failed to save data.');
                }
            })
            .catch(error => {
                console.error('Error saving citations:', error);
            });
        }

        document.getElementById('refresh').addEventListener('click', fetchCitations);
        document.getElementById('save').addEventListener('click', saveCitations);

        // Fetch citations on initial load
        fetchCitations();
    </script>
</body>
</html>
